<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link href=https://wangzhengquan.github.io/blog/ProgramingLanguage/C%2B%2B/operator%20overload/ rel=canonical><link rel=icon href=../../../assets/images/favicon.png><meta name=generator content="mkdocs-1.3.1, mkdocs-material-8.3.9"><title>operator overload - My Blogs</title><link rel=stylesheet href=../../../assets/stylesheets/main.1d29e8d0.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.cbb835fc.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><script>__md_scope=new URL("../../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme data-md-color-primary=none data-md-color-accent=none> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#assignment-operator class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../.. title="My Blogs" class="md-header__button md-logo" aria-label="My Blogs" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> My Blogs </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> operator overload </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title="My Blogs" class="md-nav__button md-logo" aria-label="My Blogs" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> My Blogs </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. class=md-nav__link> 简介 </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2> Algorithms <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Algorithms data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Algorithms </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Algorithms/Using_a_Stack_to_Evaluate_an_Expression/ class=md-nav__link> Using a Stack to Evaluate an Expression </a> </li> <li class=md-nav__item> <a href=../../../Algorithms/Using%20two%20stacks%20to%20Evaluate%20an%20Expression/ class=md-nav__link> Using two stacks to Evaluate an Expression </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3> Shell <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Shell data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Shell </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Shell/Shell%20Command/ class=md-nav__link> Shell Command </a> </li> <li class=md-nav__item> <a href=../../../Shell/Shell%20Script/ class=md-nav__link> Shell Script </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4> MacOS <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=MacOS data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> MacOS </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../MacOS/Launching%20Custom%20Daemons%20Using%20launchd/ class=md-nav__link> Launching Custom Daemons Using launchd </a> </li> <li class=md-nav__item> <a href=../../../MacOS/MacOS%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/ class=md-nav__link> MacOS常用命令 </a> </li> <li class=md-nav__item> <a href=../../../MacOS/MacOS%E5%BF%85%E5%A4%87/ class=md-nav__link> MacOS必备 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_5 type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5> Unbuntu <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Unbuntu data-md-level=1> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> Unbuntu </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Unbuntu/fix-the-no-wi-fi-adapter-found-error-on-ubuntu/ class=md-nav__link> Fix “No Wi-Fi Adapter Found” Error on Ubuntu </a> </li> <li class=md-nav__item> <a href=../../../Unbuntu/Ubuntu%E5%BF%85%E5%A4%87/ class=md-nav__link> Ubuntu必备 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_6 type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6> 编辑器 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=编辑器 data-md-level=1> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> 编辑器 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Editor/Sublime/ class=md-nav__link> Sublime </a> </li> <li class=md-nav__item> <a href=../../../Editor/VSCode/ class=md-nav__link> VSCode </a> </li> <li class=md-nav__item> <a href=../../../Editor/vim%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/ class=md-nav__link> Vim常用命令 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7 type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7> GCC <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=GCC data-md-level=1> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> GCC </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../GCC/GCC%20compiling%20processes/ class=md-nav__link> GCC compiling processes </a> </li> <li class=md-nav__item> <a href=../../../GCC/GCC%20Linking/ class=md-nav__link> GCC Linking </a> </li> <li class=md-nav__item> <a href=../../../GCC/Tools%20for%20Manipulating%20Object%20Files/ class=md-nav__link> Tools for Manipulating Object Files </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_8 type=checkbox id=__nav_8> <label class=md-nav__link for=__nav_8> GDB <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=GDB data-md-level=1> <label class=md-nav__title for=__nav_8> <span class="md-nav__icon md-icon"></span> GDB </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../GDB/gdb%20demo/ class=md-nav__link> gdb demo </a> </li> <li class=md-nav__item> <a href=../../../GDB/gdbnotes-x86-64.pdf class=md-nav__link> Summary of GDB commands </a> </li> <li class=md-nav__item> <a href=../../../GDB/GDB%20Cheat%20Sheet.pdf class=md-nav__link> GDB Cheat Sheet </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_9 type=checkbox id=__nav_9 checked> <label class=md-nav__link for=__nav_9> 编程语言 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=编程语言 data-md-level=1> <label class=md-nav__title for=__nav_9> <span class="md-nav__icon md-icon"></span> 编程语言 </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_9_1 type=checkbox id=__nav_9_1> <label class=md-nav__link for=__nav_9_1> Assembly <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Assembly data-md-level=2> <label class=md-nav__title for=__nav_9_1> <span class="md-nav__icon md-icon"></span> Assembly </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../assembly/Inline%20assembly%20for%20x86/ class=md-nav__link> Inline assembly for x86 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_9_2 type=checkbox id=__nav_9_2> <label class=md-nav__link for=__nav_9_2> C <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=C data-md-level=2> <label class=md-nav__title for=__nav_9_2> <span class="md-nav__icon md-icon"></span> C </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../C/C_takeaway/ class=md-nav__link> C语言要点 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_9_3 type=checkbox id=__nav_9_3 checked> <label class=md-nav__link for=__nav_9_3> C++ <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=C++ data-md-level=2> <label class=md-nav__title for=__nav_9_3> <span class="md-nav__icon md-icon"></span> C++ </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> operator overload <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> operator overload </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#assignment-operator class=md-nav__link> Assignment Operator </a> </li> <li class=md-nav__item> <a href=#bitshift-operators-used-for-stream-io class=md-nav__link> Bitshift Operators (used for Stream I/O) </a> </li> <li class=md-nav__item> <a href=#function-call-operator class=md-nav__link> Function call operator </a> </li> <li class=md-nav__item> <a href=#comparison-operators class=md-nav__link> Comparison operators </a> </li> <li class=md-nav__item> <a href=#arithmetic-operators class=md-nav__link> Arithmetic Operators </a> <nav class=md-nav aria-label="Arithmetic Operators"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#unary-arithmetic-operators class=md-nav__link> Unary arithmetic operators </a> </li> <li class=md-nav__item> <a href=#binary-arithmetic-operators class=md-nav__link> Binary arithmetic operators </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#array-subscripting class=md-nav__link> Array Subscripting </a> </li> <li class=md-nav__item> <a href=#operators-for-pointer-like-types class=md-nav__link> Operators for Pointer-like Types </a> </li> <li class=md-nav__item> <a href=#conversion-operators-also-known-as-user-defined-conversions class=md-nav__link> Conversion Operators (also known as User Defined Conversions) </a> <nav class=md-nav aria-label="Conversion Operators (also known as User Defined Conversions)"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#implicit-conversion-operators class=md-nav__link> Implicit Conversion Operators </a> </li> <li class=md-nav__item> <a href=#explicit-conversion-operators class=md-nav__link> Explicit Conversion Operators </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#overloading-new-and-delete-operators class=md-nav__link> Overloading new and delete operators </a> <nav class=md-nav aria-label="Overloading new and delete operators"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#basics class=md-nav__link> Basics </a> </li> <li class=md-nav__item> <a href=#class-specific-new-and-delete class=md-nav__link> Class-specific new and delete </a> </li> <li class=md-nav__item> <a href=#placement-new class=md-nav__link> Placement new </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../friend/ class=md-nav__link> friend </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_10 type=checkbox id=__nav_10> <label class=md-nav__link for=__nav_10> 收藏 <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=收藏 data-md-level=1> <label class=md-nav__title for=__nav_10> <span class="md-nav__icon md-icon"></span> 收藏 </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../save/ai_tools.md class=md-nav__link> AI Tools </a> </li> <li class=md-nav__item> <a href=../../../save/online_university/ class=md-nav__link> 网络大学 </a> </li> <li class=md-nav__item> <a href=../../../save/web_site/ class=md-nav__link> 网址收藏 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_11 type=checkbox id=__nav_11> <label class=md-nav__link for=__nav_11> Markdown <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Markdown data-md-level=1> <label class=md-nav__title for=__nav_11> <span class="md-nav__icon md-icon"></span> Markdown </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Markdown/Markdown%20Syntax/ class=md-nav__link> Markdown Syntax </a> </li> <li class=md-nav__item> <a href=../../../Markdown/Markdown%E6%A8%A1%E7%89%88/ class=md-nav__link> Markdown模版 </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_12 type=checkbox id=__nav_12> <label class=md-nav__link for=__nav_12> Git <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Git data-md-level=1> <label class=md-nav__title for=__nav_12> <span class="md-nav__icon md-icon"></span> Git </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Git/Git%20commands/ class=md-nav__link> Git commands </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_13 type=checkbox id=__nav_13> <label class=md-nav__link for=__nav_13> SSH <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=SSH data-md-level=1> <label class=md-nav__title for=__nav_13> <span class="md-nav__icon md-icon"></span> SSH </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../SSH/SSH%20command/ class=md-nav__link> SSH command </a> </li> <li class=md-nav__item> <a href=../../../SSH/SSH%20install/ class=md-nav__link> SSH install </a> </li> <li class=md-nav__item> <a href=../../../SSH/SSH%20login%20without%20password/ class=md-nav__link> SSH login without password </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_14 type=checkbox id=__nav_14> <label class=md-nav__link for=__nav_14> Vagrant <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Vagrant data-md-level=1> <label class=md-nav__title for=__nav_14> <span class="md-nav__icon md-icon"></span> Vagrant </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../Vagrant/Vagrant%20tutorial/ class=md-nav__link> Vagrant tutorial </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_15 type=checkbox id=__nav_15> <label class=md-nav__link for=__nav_15> docker <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=docker data-md-level=1> <label class=md-nav__title for=__nav_15> <span class="md-nav__icon md-icon"></span> docker </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../docker/docker/ class=md-nav__link> docker </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#assignment-operator class=md-nav__link> Assignment Operator </a> </li> <li class=md-nav__item> <a href=#bitshift-operators-used-for-stream-io class=md-nav__link> Bitshift Operators (used for Stream I/O) </a> </li> <li class=md-nav__item> <a href=#function-call-operator class=md-nav__link> Function call operator </a> </li> <li class=md-nav__item> <a href=#comparison-operators class=md-nav__link> Comparison operators </a> </li> <li class=md-nav__item> <a href=#arithmetic-operators class=md-nav__link> Arithmetic Operators </a> <nav class=md-nav aria-label="Arithmetic Operators"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#unary-arithmetic-operators class=md-nav__link> Unary arithmetic operators </a> </li> <li class=md-nav__item> <a href=#binary-arithmetic-operators class=md-nav__link> Binary arithmetic operators </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#array-subscripting class=md-nav__link> Array Subscripting </a> </li> <li class=md-nav__item> <a href=#operators-for-pointer-like-types class=md-nav__link> Operators for Pointer-like Types </a> </li> <li class=md-nav__item> <a href=#conversion-operators-also-known-as-user-defined-conversions class=md-nav__link> Conversion Operators (also known as User Defined Conversions) </a> <nav class=md-nav aria-label="Conversion Operators (also known as User Defined Conversions)"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#implicit-conversion-operators class=md-nav__link> Implicit Conversion Operators </a> </li> <li class=md-nav__item> <a href=#explicit-conversion-operators class=md-nav__link> Explicit Conversion Operators </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#overloading-new-and-delete-operators class=md-nav__link> Overloading new and delete operators </a> <nav class=md-nav aria-label="Overloading new and delete operators"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#basics class=md-nav__link> Basics </a> </li> <li class=md-nav__item> <a href=#class-specific-new-and-delete class=md-nav__link> Class-specific new and delete </a> </li> <li class=md-nav__item> <a href=#placement-new class=md-nav__link> Placement new </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1>operator overload</h1> <p>Most of the work in overloading operators is boiler-plate code. That is little wonder, since operators are merely syntactic sugar, their actual work could be done by (and often is forwarded to) plain functions. But it is important that you get this boiler-plate code right. If you fail, either your operator’s code won’t compile or your users’ code won’t compile or your users’ code will behave surprisingly.</p> <h2 id=assignment-operator>Assignment Operator</h2> <p>There's a lot to be said about assignment. However, most of it has already been said in GMan's famous <a href=https://stackoverflow.com/questions/3279543/what-is-the-copy-and-swap-idiom>Copy-And-Swap FAQ</a>, only listing the operator for reference:</p> <pre><code class=language-C++>person(const person &amp;) ;                // 1/5: Copy Ctor
person(person &amp;&amp;) noexcept ;            // 4/5: Move Ctor
person&amp; operator=(const person &amp;) ;     // 2/5: Copy Assignment
person&amp; operator=(person &amp;&amp;) noexcept ; // 5/5: Move Assignment
~person() noexcept ;                    // 3/5: Dtor

</code></pre> <h2 id=bitshift-operators-used-for-stream-io>Bitshift Operators (used for Stream I/O)</h2> <p>The bitshift operators &lt;&lt; and &gt;&gt;, although still used in hardware interfacing for the bit-manipulation functions they inherit from C, have become more prevalent as overloaded stream input and output operators in most applications. For guidance overloading as bit-manipulation operators, see the section below on Binary Arithmetic Operators. For implementing your own custom format and parsing logic when your object is used with iostreams, continue.</p> <p>The stream operators, among the most commonly overloaded operators, are binary infix operators for which the syntax specifies no restriction on whether they should be members or non-members. Since they change their left argument (they alter the stream’s state), they should, according to the rules of thumb, be implemented as members of their left operand’s type. However, their left operands are streams from the standard library, and while most of the stream output and input operators defined by the standard library are indeed defined as members of the stream classes, when you implement output and input operations for your own types, you cannot change the standard library’s stream types. That’s why you need to implement these operators for your own types as non-member functions. The canonical forms of the two are these:</p> <pre><code class=language-C++>std::ostream&amp; operator&lt;&lt;(std::ostream&amp; os, const T&amp; obj)
{
  // write obj to stream

  return os;
}

std::istream&amp; operator&gt;&gt;(std::istream&amp; is, T&amp; obj)
{
  // read obj from stream

  if( /* no valid object of T found in stream */ )
    is.setstate(std::ios::failbit);

  return is;
}
</code></pre> <p>When implementing <code>operator&gt;&gt;</code>, manually setting the stream’s state is only necessary when the reading itself succeeded, but the result is not what would be expected.</p> <h2 id=function-call-operator>Function call operator</h2> <p>The function call operator, used to create function objects, also known as functors, must be defined as a member function, so it always has the implicit this argument of member functions. Other than this, it can be overloaded to take any number of additional arguments, including zero.</p> <p>Here's an example of the syntax:</p> <pre><code class=language-C++>class foo {
public:
    // Overloaded call operator
    int operator()(const std::string&amp; y) {
        // ...
    }
};
</code></pre> <p>Usage:</p> <pre><code class=language-C++>foo f;
int a = f(&quot;hello&quot;);
</code></pre> <p>Throughout the C++ standard library, function objects are always copied. Your own function objects should therefore be cheap to copy. If a function object absolutely needs to use data which is expensive to copy, it is better to store that data elsewhere and have the function object refer to it.</p> <h2 id=comparison-operators>Comparison operators</h2> <p>The binary infix comparison operators should, according to the rules of thumb, be implemented as non-member functions1. The unary prefix negation <code>!</code> should (according to the same rules) be implemented as a member function. (but it is usually not a good idea to overload it.)</p> <p>The standard library’s algorithms (e.g. std::sort()) and types (e.g. std::map) will always only expect <code>operator&lt;</code> to be present. However, the users of your type will expect all the other operators to be present, too, so if you define <code>operator&lt;</code>, be sure to follow the third fundamental rule of operator overloading and also define all the other boolean comparison operators. The canonical way to implement them is this:</p> <pre><code class=language-C++>inline bool operator==(const X&amp; lhs, const X&amp; rhs){ /* do actual comparison */ }
inline bool operator!=(const X&amp; lhs, const X&amp; rhs){return !operator==(lhs,rhs);}
inline bool operator&lt; (const X&amp; lhs, const X&amp; rhs){ /* do actual comparison */ }
inline bool operator&gt; (const X&amp; lhs, const X&amp; rhs){return  operator&lt; (rhs,lhs);}
inline bool operator&lt;=(const X&amp; lhs, const X&amp; rhs){return !operator&gt; (lhs,rhs);}
inline bool operator&gt;=(const X&amp; lhs, const X&amp; rhs){return !operator&lt; (lhs,rhs);}
</code></pre> <p>The important thing to note here is that only two of these operators actually do anything, the others are just forwarding their arguments to either of these two to do the actual work.</p> <p>As with all rules of thumb, sometimes there might be reasons to break this one, too. If so, do not forget that the left-hand operand of the binary comparison operators, which for member functions will be *this, needs to be const, too. So a comparison operator implemented as a member function would have to have this signature:</p> <pre><code class=language-C++>bool operator&lt;(const X&amp; rhs) const { /* do actual comparison with *this */ }
</code></pre> <p>(Note the const at the end.)</p> <h2 id=arithmetic-operators>Arithmetic Operators</h2> <h3 id=unary-arithmetic-operators>Unary arithmetic operators</h3> <p>The unary increment and decrement operators come in both prefix and postfix flavor. To tell one from the other, the postfix variants take an additional dummy int argument. If you overload increment or decrement, be sure to always implement both prefix and postfix versions. Here is the canonical implementation of increment, decrement follows the same rules:</p> <pre><code class=language-C++>class X {
  X&amp; operator++()
  {
    // do actual increment
    return *this;
  }
  X operator++(int)
  {
    X tmp(*this);
    operator++();
    return tmp;
  }
};
</code></pre> <p>Note that the postfix variant is implemented in terms of prefix. Also note that postfix does an extra copy.2</p> <p>Overloading unary minus and plus is not very common and probably best avoided. If needed, they should probably be overloaded as member functions.</p> <p>Also note that the postfix variant does more work and is therefore less efficient to use than the prefix variant. This is a good reason to generally prefer prefix increment over postfix increment. While compilers can usually optimize away the additional work of postfix increment for built-in types, they might not be able to do the same for user-defined types (which could be something as innocently looking as a list iterator). Once you got used to do i++, it becomes very hard to remember to do ++i instead when i is not of a built-in type (plus you'd have to change code when changing a type), so it is better to make a habit of always using prefix increment, unless postfix is explicitly needed.</p> <h3 id=binary-arithmetic-operators>Binary arithmetic operators</h3> <p>For the binary arithmetic operators, do not forget to obey the third basic rule operator overloading: If you provide +, also provide +=, if you provide -, do not omit -=, etc. Andrew Koenig is said to have been the first to observe that the compound assignment operators can be used as a base for their non-compound counterparts. That is, operator + is implemented in terms of +=, - is implemented in terms of -= etc.</p> <p>According to our rules of thumb, + and its companions should be non-members, while their compound assignment counterparts (+= etc.), changing their left argument, should be a member. Here is the exemplary code for += and +; the other binary arithmetic operators should be implemented in the same way:</p> <pre><code class=language-C++>class X {
  X&amp; operator+=(const X&amp; rhs)
  {
    // actual addition of rhs to *this
    return *this;
  }
};
inline X operator+(X lhs, const X&amp; rhs)
{
  lhs += rhs;
  return lhs;
}
</code></pre> <p><code>operator+=</code> returns its result per reference, while <code>operator+</code> returns a copy of its result. Of course, returning a reference is usually more efficient than returning a copy, but in the case of <code>operator+</code>, there is no way around the copying. When you write <code>a + b</code>, you expect the result to be a new value, which is why <code>operator+</code> has to return a new value.3 Also note that <code>operator+</code> takes its left operand by copy rather than by const reference. The reason for this is the same as the reason giving for <code>operator=</code> taking its argument per copy.</p> <p>The bit manipulation operators <code>~</code> <code>&amp;</code> <code>|</code> <code>^</code> <code>&lt;&lt;</code> <code>&gt;&gt;</code> should be implemented in the same way as the arithmetic operators. However, (except for overloading &lt;&lt; and <code>&gt;&gt;</code> for output and input) there are very few reasonable use cases for overloading these.</p> <p>Again, the lesson to be taken from this is that <code>a += b</code> is, in general, more efficient than <code>a + b</code> and should be preferred if possible.</p> <h2 id=array-subscripting>Array Subscripting</h2> <p>The array subscript operator is a binary operator which must be implemented as a class member. It is used for container-like types that allow access to their data elements by a key. The canonical form of providing these is this:</p> <pre><code class=language-C++>class X {
        value_type&amp; operator[](index_type idx);
  const value_type&amp; operator[](index_type idx) const;
  // ...
};
</code></pre> <p>Unless you do not want users of your class to be able to change data elements returned by <code>operator[]</code> (in which case you can omit the non-const variant), you should always provide both variants of the operator.</p> <p>If value_type is known to refer to a built-in type, the const variant of the operator should better return a copy instead of a const reference:</p> <pre><code class=language-C++>class X {
  value_type&amp; operator[](index_type idx);
  value_type  operator[](index_type idx) const;
  // ...
};
</code></pre> <h2 id=operators-for-pointer-like-types>Operators for Pointer-like Types</h2> <p>For defining your own iterators or smart pointers, you have to overload the unary prefix dereference operator <code>*</code> and the binary infix pointer member access operator <code>-&gt;</code>:</p> <pre><code class=language-C++>class my_ptr {
        value_type&amp; operator*();
  const value_type&amp; operator*() const;
        value_type* operator-&gt;();
  const value_type* operator-&gt;() const;
};
</code></pre> <h2 id=conversion-operators-also-known-as-user-defined-conversions>Conversion Operators (also known as User Defined Conversions)</h2> <p>In C++ you can create conversion operators, operators that allow the compiler to convert between your types and other defined types. There are two types of conversion operators, implicit and explicit ones.</p> <h3 id=implicit-conversion-operators>Implicit Conversion Operators</h3> <p>An implicit conversion operator allows the compiler to implicitly convert (like the conversion between int and long) the value of a user-defined type to some other type.</p> <p>The following is a simple class with an implicit conversion operator:</p> <pre><code class=language-C++>class my_string {
public:
  operator const char*() const {return data_;} // This is the conversion operator
private:
  const char* data_;
};
</code></pre> <p>Implicit conversion operators, like one-argument constructors, are user-defined conversions. Compilers will grant one user-defined conversion when trying to match a call to an overloaded function.</p> <pre><code class=language-C++>void f(const char*);

my_string str;
f(str); // same as f( str.operator const char*() )

</code></pre> <p>At first this seems very helpful, but the problem with this is that the implicit conversion even kicks in when it isn’t expected to. In the following code, <code>void f(const char*)</code> will be called because <code>my_string()</code> is not an <a href=https://stackoverflow.com/questions/3601602/what-are-rvalues-lvalues-xvalues-glvalues-and-prvalues>lvalue</a>, so the first does not match:</p> <pre><code class=language-C++>void f(my_string&amp;);
void f(const char*);

f(my_string());
</code></pre> <p>Beginners easily get this wrong and even experienced C++ programmers are sometimes surprised because the compiler picks an overload they didn’t suspect. These problems can be mitigated by explicit conversion operators.</p> <h3 id=explicit-conversion-operators>Explicit Conversion Operators</h3> <p>Unlike implicit conversion operators, explicit conversion operators will never kick in when you don't expect them to. The following is a simple class with an explicit conversion operator:</p> <pre><code class=language-C++>class my_string {
public:
  explicit operator const char*() const {return data_;}
private:
  const char* data_;
};
</code></pre> <blockquote> <p>Notice the <code>explicit</code>. <br> Now when you try to execute the unexpected code from the implicit conversion operators, you get a compiler error.</p> </blockquote> <p>To invoke the explicit cast operator, you have to use <code>static_cast</code>, a C-style cast, or a constructor style cast ( i.e. <code>T(value)</code> ).</p> <p>However, there is one exception to this: The compiler is allowed to implicitly convert to bool. In addition, the compiler is not allowed to do another implicit conversion after it converts to bool (a compiler is allowed to do 2 implicit conversions at a time, but only 1 user-defined conversion at max).</p> <p>Because the compiler will not cast "past" bool, explicit conversion operators now remove the need for the Safe Bool idiom. For example, smart pointers before C++11 used the Safe Bool idiom to prevent conversions to integral types. In C++11, the smart pointers use an explicit operator instead because the compiler is not allowed to implicitly convert to an integral type after it explicitly converted a type to bool.</p> <h2 id=overloading-new-and-delete-operators>Overloading new and delete operators</h2> <h3 id=basics>Basics</h3> <p>In C++, when you write a new expression like new T(arg) two things happen when this expression is evaluated: First operator new is invoked to obtain raw memory, and then the appropriate constructor of T is invoked to turn this raw memory into a valid object. Likewise, when you delete an object, first its destructor is called, and then the memory is returned to operator delete. C++ allows you to tune both of these operations: memory management and the construction/destruction of the object at the allocated memory. The latter is done by writing constructors and destructors for a class. Fine-tuning memory management is done by writing your own operator new and operator delete.</p> <p>The first of the basic rules of operator overloading – don’t do it – applies especially to overloading new and delete. Almost the only reasons to overload these operators are performance problems and memory constraints, and in many cases, other actions, like changes to the algorithms used, will provide a much higher cost/gain ratio than attempting to tweak memory management.</p> <p>The C++ standard library comes with a set of predefined new and delete operators. The most important ones are these:</p> <pre><code class=language-C++>void* operator new(std::size_t) throw(std::bad_alloc); 
void  operator delete(void*) throw(); 
void* operator new[](std::size_t) throw(std::bad_alloc); 
void  operator delete[](void*) throw(); 
</code></pre> <p>The first two allocate/deallocate memory for an object, the latter two for an array of objects. If you provide your own versions of these, they will not overload, but replace the ones from the standard library. If you overload operator new, you should always also overload the matching operator delete, even if you never intend to call it. The reason is that, if a constructor throws during the evaluation of a new expression, the run-time system will return the memory to the operator delete matching the operator new that was called to allocate the memory to create the object in. If you do not provide a matching operator delete, the default one is called, which is almost always wrong. If you overload new and delete, you should consider overloading the array variants, too.</p> <h3 id=class-specific-new-and-delete>Class-specific new and delete</h3> <p>Most commonly you will want to fine-tune memory management because measurement has shown that instances of a specific class, or of a group of related classes, are created and destroyed often and that the default memory management of the run-time system, tuned for general performance, deals inefficiently in this specific case. To improve this, you can overload new and delete for a specific class:</p> <pre><code class=language-C++>class my_class { 
  public: 
    // ... 
    void* operator new(std::size_t);
    void  operator delete(void*);
    void* operator new[](std::size_t);
    void  operator delete[](void*);
    // ...  
}; 
</code></pre> <p>Overloaded thus, new and delete behave like static member functions. For objects of my_class, the std::size_t argument will always be sizeof(my_class). However, these operators are also called for dynamically allocated objects of derived classes, in which case it might be greater than that.</p> <h3 id=placement-new>Placement new</h3> <p>C++ allows new and delete operators to take additional arguments. So-called placement new allows you to create an object at a certain address which is passed to:</p> <pre><code>class X { /* ... */ };
char buffer[ sizeof(X) ];
void f()
{ 
  X* p = new(buffer) X(/*...*/);
  // ... 
  p-&gt;~X(); // call destructor 
} 
</code></pre> <p>The standard library comes with the appropriate overloads of the new and delete operators for this:</p> <pre><code class=language-C++>void* operator new(std::size_t,void* p) throw(std::bad_alloc); 
void  operator delete(void* p,void*) throw(); 
void* operator new[](std::size_t,void* p) throw(std::bad_alloc); 
void  operator delete[](void* p,void*) throw(); 
</code></pre> <p>Note that, in the example code for placement new given above, operator delete is never called, unless the constructor of X throws an exception.</p> <p>You can also overload new and delete with other arguments. As with the additional argument for placement new, these arguments are also listed within parentheses after the keyword new. Merely for historical reasons, such variants are often also called placement new, even if their arguments are not for placing an object at a specific address.</p> <blockquote> <p>https://stackoverflow.com/questions/4421706/what-are-the-basic-rules-and-idioms-for-operator-overloading/</p> <p>https://stackoverflow.com/questions/3279543/what-is-the-copy-and-swap-idiom</p> <p>https://stackoverflow.com/questions/4172722/what-is-the-rule-of-three</p> </blockquote> </article> </div> </div> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../../C/C_takeaway/ class="md-footer__link md-footer__link--prev" aria-label="Previous: C语言要点" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> C语言要点 </div> </div> </a> <a href=../friend/ class="md-footer__link md-footer__link--next" aria-label="Next: friend" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> friend </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.b97dbffb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script> <script src=../../../assets/javascripts/bundle.6c7ad80a.min.js></script> </body> </html>